---
id: TASK-2024-036
title: "Задача 2.2.3: Реализация агента со структурированным выводом (Spring AI)"
status: backlog
priority: high
type: task
estimate: 8h
created: 2024-07-30
updated: 2025-11-20
parents: [TASK-2024-033]
dependencies: [TASK-2024-035, TASK-2024-097, TASK-2024-116]
arch_refs: [ADR-0016, ADR-0031]
---
## Описание
Настроить `ai-service` для получения гарантированно валидного JSON от модели `gpt-oss:20b`. Использовать `BeanOutputConverter` из Spring AI.

## Ключевые шаги
1.  Получить шаблон системного промпта из `PromptManager` (см. TASK-2024-116).
2.  Внедрить в промпт схему JSON, сгенерированную `BeanOutputConverter`.
3.  Вызвать `ChatClient`.
4.  Распарсить ответ в Java Record/DTO.
5.  Реализовать механизм ретраев (автоматический повтор запроса при ошибке парсинга JSON).

## Критерии приемки
-   Сервис принимает запрос, обращается к LLM и возвращает строго типизированный Java-объект.
-   Промпт берется из БД.
