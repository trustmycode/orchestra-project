---
id: TASK-2024-041
title: "Задача 4.8 (AI): Предложение по передаче данных между шагами (Data Transfer)"
status: backlog
priority: medium
type: feature
estimate: 16h
created: 2024-07-30
updated: 2024-07-30
parents: [TASK-2024-027]
dependencies: [TASK-2024-097, TASK-2024-098, TASK-2024-036]
arch_refs: [ADR-0016, ADR-0025]
audit_log:
  - {date: 2024-07-30, user: "@RoboticArchitect", action: "created with status backlog"}
---
## Описание
Реализовать AI-функцию, которая анализирует последовательность шагов в сценарии и предлагает, как связать данные между ними. Например, как использовать `orderId` из ответа шага "Создать заказ" в URL или теле запроса шага "Получить статус заказа". Функция строится как агент `sgr-agent-core`, который использует инструменты для чтения схем, описаний шагов и поиска подходящих полей. Результат используется автоматически в `ProcessToScenarioGenerator` (см. `TASK-2024-031`) и в интерактивном UI, чтобы пользователю сразу показывались подготовленные плейсхолдеры.

## Ключевые шаги
1. Создать в `ai-service` эндпоинт, который принимает два `ScenarioStep` (источник и приёмник).
2. Реализовать логику, которая анализирует JSON Schema ответа источника и JSON Schema запроса приёмника и предлагает маппинги полей (например, `response.body.id` -> `request.params.orderId`).
3. В UI конструктора сценариев, при добавлении нового шага, автоматически вызывать эту функцию и предлагать пользователю готовые плейсхолдеры для вставки (например, `{{step.Task_CreateOrder.response.body.id}}`).
4. Интегрировать вызов функции в `ProcessToScenarioGenerator`, чтобы автоматически расставлять плейсхолдеры при генерации `ScenarioSuite`.

## Критерии приемки
- После добавления шага "Получить статус заказа" после шага "Создать заказ" UI предлагает пользователю использовать `{{...}}` плейсхолдер для `orderId`.
- При генерации сценария из BPMN нужные плейсхолдеры подставляются автоматически (пользователь видит их в сгенерированном шаге).
- Пользователь может принять или отклонить предложение одним кликом.
