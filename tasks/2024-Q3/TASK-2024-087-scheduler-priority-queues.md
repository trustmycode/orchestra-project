---
id: TASK-2024-087
title: "Задача 4.8.3 (Backend/Infra): Внедрение приоритетных очередей"
status: backlog
priority: medium
type: task
estimate: 4h
created: 2024-07-30
parents: [TASK-2024-084]
dependencies: [TASK-2024-086]
arch_refs: [ADR-0020]
---
## Описание
Разделить поток задач на приоритетные (например, запущенные вручную из UI) и фоновые (CI/CD), чтобы интерактивные тесты не ждали завершения длинных регрессионных прогонов, как рекомендует `ADR-0020` для борьбы с "шумными соседями".

## Ключевые шаги
1. **Конфигурация RabbitMQ:**
   - Создать две очереди: `runs.priority.high` и `runs.priority.low`.
   - (Опционально) Настроить отдельные пулы воркеров `orchestra-executor` для каждой очереди, выделив больше ресурсов для приоритетной.
2. **Логика `Scheduler`:**
   - Модифицировать `SchedulerService` так, чтобы он отправлял сообщения в разные очереди в зависимости от поля `priority` в `TestRun`.
3. **Логика `orchestra-executor`:**
   - Настроить `JobListener`'ы для прослушивания обеих очередей.

## Критерии приемки
- Задачи с высоким приоритетом попадают в `runs.priority.high` и обрабатываются в первую очередь.
- Задачи с низким приоритетом не блокируют выполнение высокоприоритетных.
- Обе очереди и обработчики документированы как часть реализации ADR.
