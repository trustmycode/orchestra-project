```markdown

---

id: TASK-2024-128

title: "Задача: UI для генерации дата-сетов с выбором контекста"

status: todo

priority: medium

type: feature

estimate: 4h

created: 2024-07-31

updated: 2024-07-31

parents: [TASK-2024-037]

dependencies: [TASK-2024-126]

arch_refs: [ADR-0011, ADR-0019]

audit_log:

  - {date: 2024-07-31, user: "@RoboticArchitect", action: "created"}

---

## Описание

Обновить компонент `DataSetListView.tsx`, заменив простую кнопку генерации на модальное окно (Wizard). Генерация данных должна быть привязана к контексту (Сценарий или Сьют), чтобы AI понимал структуру необходимых данных.

## Проблема

Текущий метод `generateAiDataSimple` не принимает аргументов. Реальный `AiService` требует понимания того, для чего генерируются данные (какие поля нужны, какие типы данных), иначе он не сможет построить `DataPlan`.

## Ключевые шаги

1.  **Создать компонент `AiDataGenerationModal`:**

    *   **Поле "Environment" (Select):** Обязательно. Нужно для работы Resolver'а (подключение к БД).

    *   **Поле "Target Scope" (Radio/Select):**

        *   `Scenario` (по умолчанию)

        *   `Suite` (опционально, если бэкенд поддерживает)

    *   **Поле "Context Reference" (Select):**

        *   Если выбран Scope `Scenario` -> выпадающий список всех сценариев (`TestScenarioSummary`).

        *   При выборе сценария сохраняем его `scenarioId`.

    *   **Поле "Custom Instructions" (Textarea):** Дополнительные пожелания для AI (например, "Use edge cases for prices").

2.  **Логика вызова:**

    *   Использовать метод `generateAiData` (из TASK-2024-080).

    *   Маппинг полей:

        *   `scenarioId` -> выбранный сценарий.

        *   `environmentId` -> выбранное окружение.

        *   `mode` -> можно добавить переключатель (Happy Path / Negative), либо слать `HAPPY_PATH`.

3.  **Обработка результата:**

    *   Полученный JSON (`response.data`) подставлять в поле редактирования дата-сета.

    *   Автоматически выставлять Scope дата-сета в соответствии с выбором в модалке.

    *   Если выбрана привязка к сценарию, заполнять поле `scenarioId` в самом дата-сете.

## Критерии приемки

*   При нажатии "Generate with AI" открывается диалог.

*   Нельзя запустить генерацию без выбора Environment и Scenario.

*   После генерации в редакторе появляется JSON, соответствующий структуре выбранного сценария.

```

