---
id: TASK-2024-083
title: "Задача 3.1.8 (Backend): Обеспечение идемпотентности потребителя задач"
status: backlog
priority: high
type: task
estimate: 4h
created: 2024-07-30
parents: [TASK-2024-022]
dependencies: [TASK-2024-082]
arch_refs: [ADR-0020]
---
## Описание
Сделать обработчик сообщений в `orchestra-executor` идемпотентным, чтобы повторная доставка сообщения из RabbitMQ (`at-least-once`), описанная в `ADR-0020`, не приводила к повторному выполнению уже завершенной или активной задачи.

## Ключевые шаги
1. В `JobListener` перед захватом аренды проверять текущий статус `TestRun`.
2. Если статус `IN_PROGRESS` (и аренда активна) или `PASSED`/`FAILED`, сообщение должно быть проигнорировано и подтверждено (`ack`).

## Критерии приемки
- Повторная отправка сообщения с тем же `testRunId` в очередь не вызывает повторного выполнения теста.
- Логика идемпотентности документирована и соотнесена с рекомендациями ADR.
