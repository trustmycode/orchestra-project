---
id: ARCH-security-multitenancy
title: "Безопасность, RBAC и мультиарендность"
type: feature
layer: infrastructure
owner: '@architect'
version: v1
status: planned
created: 2024-07-29
updated: 2024-07-29
tags: [security, rbac, multitenancy, keycloak]
depends_on: [ARCH-data-model]
referenced_by: []
---
## Контекст
Платформа Orchestra предназначена для использования несколькими командами или клиентами (арендаторами). Необходимо обеспечить строгую изоляцию данных между арендаторами и гранулированное управление доступом внутри каждого арендатора.

## Структура
*   **Мультиарендность**: Все ключевые сущности в базе данных имеют обязательное поле `tenantId`. Все API-запросы и операции с данными фильтруются по `tenantId` текущего пользователя, что обеспечивает логическую изоляцию данных.
*   **Аутентификация**: Интеграция с внешним провайдером идентификации (IDP) по протоколу OIDC (например, Keycloak). `orchestra-api` валидирует JWT-токены, извлекая из них идентификатор пользователя и его `tenantId`.
*   **Авторизация (RBAC)**: Внедряется ролевая модель доступа (Role-Based Access Control) с предопределенными ролями:
    *   `ORG_ADMIN`: Управление пользователями и настройками арендатора.
    *   `TEST_DESIGNER`: Создание и редактирование артефактов (процессов, сценариев, данных).
    *   `TEST_RUNNER`: Запуск тестов и просмотр отчетов.
    *   `VIEWER`: Только просмотр.

## Поведение
При каждом запросе к API система проверяет JWT-токен, определяет `tenantId` и роли пользователя. На основе этой информации применяются политики доступа, разрешающие или запрещающие выполнение операции. Любая попытка доступа к данным другого арендатора блокируется на уровне приложения.
