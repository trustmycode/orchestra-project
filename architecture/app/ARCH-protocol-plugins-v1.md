---
id: ARCH-protocol-plugins
title: "Плагинная модель поддержки протоколов"
type: feature
layer: application
owner: '@architect'
version: v1
status: planned
created: 2024-07-29
updated: 2024-07-29
tags: [plugin, spi, extensibility]
depends_on: [ARCH-execution-engine]
referenced_by: []
---
## Контекст
Для поддержки различных протоколов взаимодействия (HTTP, DB, Kafka и др.) без изменения ядра системы используется плагинная архитектура. Это позволяет легко расширять функциональность системы для тестирования новых типов сервисов.

## Структура
Вводится сервисный интерфейс `ProtocolPlugin`, который должен быть реализован для каждого поддерживаемого протокола.
*   **`ProtocolSpecParser`**: Отвечает за парсинг спецификаций (например, OpenAPI для HTTP).
*   **`EndpointMatcher`**: Сопоставляет шаги процесса с конкретными эндпоинтами, топиками или методами из спецификации.
*   **`StepExecutor`**: Выполняет конкретный шаг сценария, отправляя запрос или выполняя проверку в SUT.
*   **`ContractValidator`**: Проверяет соответствие ответа или сообщения контракту, описанному в спецификации.
*   **`ProtocolRegistry`**: Центральный компонент, который хранит и предоставляет экземпляры плагинов по их идентификаторам (например, "http", "db").

## Поведение
Когда `orchestra-executor` выполняет шаг сценария, он определяет `channelType` шага (например, `HTTP_REST`), запрашивает у `ProtocolRegistry` соответствующий плагин и делегирует ему выполнение шага через интерфейс `StepExecutor`.

## Эволюция
### Планируемые изменения
— Добавление плагинов для gRPC, очередей (RabbitMQ, SQS) и других протоколов по мере необходимости.
